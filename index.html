<!DOCTYPE html>
<html>

<head>
    <title>DWS Demo</title>
</head>

<body>
    <h1>Dynamsoft Webcam SDK: Hello World</h1>
    <select size="1" id="source" width="220px" onchange="onSourceChanged()"></select>
    <input type="button" value="Capture" onclick="onCapture();" />
    <input type="button" value="Save" onclick="onSave();" />

    <div id="video-container"> </div>
    <div id="image-container"> </div>

    <script type="text/javascript" src="DWSResources/dynamsoft.webcam.config.js"> </script>
    <script type="text/javascript" src="DWSResources/dynamsoft.webcam.initiate.js"> </script>
    <script>
        var dwsObject, imageViewer;
        var width = 480, height = 320;

        function onInitSuccess(videoViewerId, imageViewerId) { 
            dwsObject = dynamsoft.dwsEnv.getObject(videoViewerId); // Get the Dynamsoft Webcam object
            dwsObject.videoviewer.setWidth(width);
            dwsObject.videoviewer.setHeight(height);

            imageViewer = dwsObject.getImageViewer(imageViewerId); // Get a specific image viewer
            imageViewer.ui.setWidth(width);
            imageViewer.ui.setHeight(height);

            var cameraList = dwsObject.camera.getCameraList(); // Get a list of available cameras
            for (var i = 0; i < cameraList.length; i++) {
                document.getElementById("source").options.add(new Option(cameraList[i], i));
            }
						
            if (cameraList.length > 0) {
                // Call this method to take the ownership, 
                // in case the listed camera is occupied by another Dynamsoft Webcam process.
                dwsObject.camera.takeCameraOwnership(cameraList[0]);
                dwsObject.camera.playVideo();
            } else {
                alert('No camera is connected.');
            }
        }

        function onInitFailure(errorCode, errorString) {
            alert('Init failed: ' + errorString);
        };

        function onSourceChanged() {
            if (!dwsObject) return;

            var source = document.getElementById("source");
            var camera = source.options[source.selectedIndex].text;
            dwsObject.camera.takeCameraOwnership(camera);
            dwsObject.camera.playVideo();
        };

        function onCapture() {
            if (!dwsObject) return;

            dwsObject.camera.captureImage('image-container');

            if (dwsObject.getErrorCode() !== EnumDWS_ErrorCode.OK) {
                alert('Capture error: ' + dwsObject.getErrorString());
            }
        };

        function onSave() {
            if (!imageViewer) return;

            // Convert image indices to an array
            var data = imageViewer.io.convertToBase64([imageViewer.image.getIndex()], imageViewer.io.EnumImageType.PNG);

            if (!data) return;

            // Only for Chrome
            var link = document.createElement('a');
            link.download = "tmp.png";
            link.href = "data:image/png;base64," + data;
            link.click();
        };

        // Initialize Dynamsoft Webcam object
        dynamsoft.dwsEnv.init('video-container', 'image-container', onInitSuccess, onInitFailure); 

        // Destroy Dynamsoft Webcam object when the page is closed
        window.onbeforeunload = function() {
            if (dwsObject) dwsObject.destroy();
        };

    </script>
</body>

</html>